アルゴリズムの深層解説1. Height Threshold：離地イベントのトリガーこの値は、足を「地面（IDLE）」から「空中（LIFTED）」へ遷移させるための絶対的な障壁です。内部挙動: smoothed_lift > self.params.height_threshold詳細: MediaPipeの pose_world_landmarks はメートル単位の実寸を推定します。0.15 なら「かかとが15cm浮いた」瞬間に計測が開始されます。落とし穴: この値を上げすぎると、膝を高く上げる運動（もも上げ）以外は検知できなくなります。逆に下げすぎると、立っている時の微小な重心移動だけで「歩き出した」と誤認されます。

2. Dead Zone：チャタリング防止の緩衝材ここが最もテクニカルな部分です。離地判定と着地判定のしきい値に「差」を設けています。内部挙動: 接地判定ライン = height_threshold - dead_zone詳細: 例えば Threshold が 0.15、Dead Zone が 0.02 の場合、15cmで「離地」と判定された後、13cm（0.15 - 0.02）を切るまで「着地」とは認められません。効果: もしこの値が 0 だと、足がちょうど 15cm 付近でわずかに震えただけで、「離地→着地→離地」と高速にカウントが回るチャタリング現象が起きます。これを防ぐための「遊び」です。

3. Min Stable Frames：時間軸による確定空間的なしきい値（高さ）をクリアした後、さらに時間的なしきい値を課します。内部挙動: stable_frames >= min_stable_frames詳細: 足が 接地判定ライン を下回った状態が、**指定されたフレーム数（例えば5枚連続）**続いて初めて「着地完了」とみなします。効果: 激しい動きの中で一瞬だけ足が下がったように見えるノイズを無視できます。値を大きくするほど「どっしりした歩行」しか検知しなくなります。

4. Time Smoothing：入力の純度MediaPipeの生データ（Raw Data）は、照明条件や服のシワによって毎フレーム数ミリ〜数センチ単位で激しくブレます。内部挙動: collections.deque を用いた移動平均。詳細: 5 に設定すると、直近5フレームの平均値を「現在の高さ」として採用します。数学的側面: これはローパスフィルタとして機能します。高周波なノイズ（ピクつき）をカットしますが、位相遅れ（現実の動きより数ミリ秒遅れてグラフが動く現象）が発生します。過大設定: 動きがヌルヌルしますが、足を下ろしたのにプログラム上はまだ浮いている判定になり、テンポの速い歩行についてこれなくなります。

5. FPS Limit Delay：時間分解能の制御cv2.waitKey(delay) に渡される値です。内容: ループの終わりに強制的な「待ち時間」を挿入します。影響: * 10ms なら理論上の最大FPSは 100。100ms なら最大 10。注意点: Min Stable Frames と密接に関係します。FPSを下げると「5フレーム」にかかる実時間が長くなるため、結果として Min Stable Frames のハードルが極端に上がることになります。


パラメータ相関図状況調整すべき項目理由足踏みが速すぎてカウントが漏れるMin Stable Frames を減らす / Time Smoothing を減らす判定の「関門」を物理的・時間的に短くし、高速な状態遷移を許可するため。一歩しか歩いていないのに2歩と出るDead Zone を増やす / Min Stable Frames を増やす判定に慎重さ（粘り）を持たせ、小さな上下動を無視させるため。MediaPipeの骨格が震えて安定しないTime Smoothing を増やす統計的にノイズを丸めるため。PCのファンが唸って重いFPS Limit Delay を増やすCPUの空き時間を意図的に作るため。


1. 企画の核と技術の整合性
肯定的評価：身体性と時間の直結
企画書にある「いっぽごとに分針がすすむ」という体験において、このプログラムは非常に適しています。単なる「動体検知」ではなく、MediaPipeで**「足の離地と接地」を厳密に判定**しようとしている点は、作品の説得力を高めます。曖昧なセンサー反応ではなく、鑑賞者の「確かな一歩」をトリガーに時計を動かすことで、身体性と時間の不可分性がより強調されるでしょう。

懸念点：俯瞰カメラとMediaPipeの相性
企画書ではカメラを「俯瞰に近い位置」に設置する予定とありますが、MediaPipe Poseは本来、水平に近い角度（全身が見える状態）で学習されています。

問題: 真上からの俯瞰だと、足の「高さ（y軸）」の変化が極めて小さくなり、検知精度が著しく低下します。

対策: 斜め上からの俯瞰にするか、あるいは企画書にある「NoIRカメラ＋赤外線投光器」を使い、コントラストを強調して骨格推定を助ける必要があります。

2. 展示空間における「カメラ判定」の課題
照明干渉とIRフィルター
企画書にある「IR Pass Filter」の使用は賢明です。プロジェクターの映像（可視光）がカメラに入り込むと、映像内の波の動きを「人の動き」と誤認するループ（フィードバック）が起きます。

助言: 赤外線ライトで人だけを照らし、カメラには赤外線だけを通すフィルタを貼ることで、プロジェクターの光を「無視」できます。これにより、暗い展示室でも安定した判定が可能になります。

処理負荷と「PCレンタル料」の妥当性
企画書に「能力値が高いパソコンが必要」とあり、予算も25,000円計上されています。これは極めて妥当、あるいは少し足りない可能性があります。

理由: このプログラム（MediaPipe）と、高精細な「波の映像生成（恐らくTouchDesignerやUnity、あるいはGLSLなど）」を同時に走らせる場合、GPUの性能が生命線となります。展示期間が10日間であれば、安定稼働のためにゲーミングPCクラスのスペックを確保すべきです。

3. プログラムのパラメータ調整の重要性
展示会場の環境（床の材質、観客の靴の種類、プロジェクターとの距離）によって、プログラム内の以下の数値は必ず「現場で」狂います。

height_threshold (高さのしきい値):
床に白い布を敷くとのことですが、その反射率によってカメラが捉える「地面」の座標が微妙に浮くことがあります。

min_stable_frames (安定フレーム数):
「カタ、カタ」と1分ずつ進む時計の演出において、チャタリング（1歩で2分進んでしまう）は興醒めです。この値を現場で追い込み、1歩＝1トリガーを死守する必要があります。